<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini API Diagnostic Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-900 text-white p-8 font-sans">
    <div class="max-w-2xl mx-auto space-y-6">
        <h1 class="text-2xl font-bold text-blue-400">Gemini API Diagnostic</h1>
        <p class="text-gray-400">This tool tests your API Key against multiple endpoints to find the correct
            configuration.</p>

        <div class="space-y-2">
            <label class="block text-sm font-medium">Paste your API Key here:</label>
            <div class="flex gap-2">
                <input type="text" id="apiKey"
                    class="w-full bg-slate-800 border border-slate-600 rounded px-3 py-2 text-white"
                    placeholder="AIzaSy...">
                <button onclick="runDiagnostics()" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-500 font-bold">Run
                    Test</button>
            </div>
        </div>

        <div id="logs"
            class="bg-black/50 p-4 rounded-lg font-mono text-xs whitespace-pre-wrap h-96 overflow-auto border border-white/10">
            Waiting for input...</div>
    </div>

    <script>
        function log(msg, type = 'info') {
            const div = document.getElementById('logs');
            const color = type === 'error' ? 'text-red-400' : (type === 'success' ? 'text-green-400' : 'text-gray-300');
            div.innerHTML += `<div class="${color} mb-1 border-b border-white/5 pb-1">[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            div.scrollTop = div.scrollHeight;
        }

        async function runDiagnostics() {
            const key = document.getElementById('apiKey').value.trim();
            const logs = document.getElementById('logs');
            logs.innerHTML = ''; // Clear

            if (!key) {
                log('Please enter an API Key.', 'error');
                return;
            }

            log(`Starting diagnostics for Key: ${key.substring(0, 10)}...`);

            // Test 1: List Models (v1beta)
            log('Test 1: GET https://generativelanguage.googleapis.com/v1beta/models...');
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${key}`);
                const data = await response.json();

                if (response.ok) {
                    log('Success! API Key is valid (AI Studio).', 'success');
                    log(`Available Models: ${data.models.map(m => m.name).join(', ')}`);

                    // Check if generateContent is supported for flash
                    const flash = data.models.find(m => m.name.includes('gemini-1.5-flash'));
                    if (flash) {
                        log(`Found gemini-1.5-flash: Supported methods: ${flash.supportedGenerationMethods.join(', ')}`, 'success');
                    } else {
                        log('Warning: gemini-1.5-flash not found in list.', 'error');
                    }
                } else {
                    log(`Failed (v1beta): ${response.status} - ${data.error?.message}`, 'error');

                    if (response.status === 404) {
                        log('Diagnosis: The endpoint returned 404. This is highly unusual for the base URL.', 'error');
                    }
                }
            } catch (e) {
                log(`Network Error (Test 1): ${e.message}`, 'error');
            }

            log('---');

            // Test 2: Generate Content (v1beta) - gemini-1.5-flash
            const model = 'gemini-1.5-flash';
            log(`Test 2: POST generateContent (${model})...`);

            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${key}`;
                log(`URL: ${url}`);

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: "Hello" }] }] })
                });

                const data = await response.json();

                if (response.ok) {
                    log(`Success! Response: "${data.candidates?.[0]?.content?.parts?.[0]?.text?.substring(0, 50)}..."`, 'success');
                    log('CONCLUSION: This model name and endpoint WORK.', 'success');
                } else {
                    log(`Failed: ${response.status} - ${data.error?.message}`, 'error');
                    log(`Full Error: ${JSON.stringify(data, null, 2)}`);
                    if (response.status === 404) {
                        log('Diagnosis: 404 means the MODEL NAME or VERSION in the URL is rejected by Google.', 'error');
                    }
                }
            } catch (e) {
                log(`Network Error (Test 2): ${e.message}`, 'error');
            }
        }
    </script>
</body>

</html>